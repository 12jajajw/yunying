from PIL import Image, ImageDraw, ImageFont
import textwrap
import random

# å¡ç‰‡å‚æ•°
WIDTH, HEIGHT = 800, 1200  # å°çº¢ä¹¦æ¨èå°ºå¯¸
MARGIN = 50  # è¾¹è·
LINE_SPACING = 15  # è¡Œé—´è·

# éšæœºèƒŒæ™¯é¢œè‰²
def get_random_background():
    """éšæœºç”Ÿæˆæµ…è‰²èƒŒæ™¯"""
    colors = [
        (255, 240, 245),  # æµ…ç²‰è‰²
        (240, 255, 240),  # æµ…ç»¿è‰²
        (240, 248, 255),  # æµ…è“è‰²
        (255, 250, 205),  # æµ…é»„è‰²
        (230, 230, 250),  # æµ…ç´«è‰²
    ]
    return random.choice(colors)

# éšæœºå­—ä½“
def get_random_font(size):
    """éšæœºé€‰æ‹©å­—ä½“"""
    fonts = [
        "SourceHanSans-Regular.otf",  # æ€æºé»‘ä½“
        "Roboto-Regular.ttf",         # Roboto
        "OpenSans-Regular.ttf",       # Open Sans
        "Lobster-Regular.ttf",        # Lobster
    ]
    font_path = random.choice(fonts)
    try:
        return ImageFont.truetype(font_path, size)
    except IOError:
        print(f"å­—ä½“æ–‡ä»¶ {font_path} æœªæ‰¾åˆ°ï¼Œè¯·ç¡®ä¿è·¯å¾„æ­£ç¡®ï¼")
        exit()

# è‡ªåŠ¨æ¢è¡Œå¤„ç†
def wrap_text(text, font, max_width):
    """å°†æ–‡æœ¬æŒ‰å®½åº¦è‡ªåŠ¨æ¢è¡Œ"""
    lines = []
    for line in text.split("\n"):
        if draw.textlength(line, font=font) <= max_width:
            lines.append(line)
        else:
            wrapped_lines = textwrap.wrap(line, width=int(max_width / (size * 0.6)))
            lines.extend(wrapped_lines)
    return lines

# è¾“å…¥æ–‡æ¡ˆ
title = "ğŸŒŸå‘¨æœ«æ—…è¡Œ | æ¥ä¸€åœºè¯´èµ°å°±èµ°çš„çŸ­é€”å†’é™©ï¼"
text = """
è¿™ä¸ªå‘¨æœ«ï¼Œæˆ‘é€‰æ‹©äº†å»æ­å·è¥¿æ¹–æ”¾æ¾å¿ƒæƒ… ğŸŒ¿ã€‚
æ¸…æ™¨çš„æ¹–é¢æ³¢å…‰ç²¼ç²¼ï¼Œæ­é…ä¸€æ¯çƒ­å’–å•¡â˜•ï¸ï¼Œ
ç®€ç›´æ˜¯æ²»æ„ˆç³»çš„å®Œç¾ç»„åˆï¼
æ¨èå¤§å®¶æ¥è¿™é‡Œæ„Ÿå—è‡ªç„¶ä¹‹ç¾ï¼Œäº«å—ç‰‡åˆ»å®é™ï½
"""

# åˆ›å»ºç”»å¸ƒ
background_color = get_random_background()
image = Image.new("RGB", (WIDTH, HEIGHT), background_color)
draw = ImageDraw.Draw(image)

# åŠ è½½éšæœºå­—ä½“
font_title = get_random_font(50)  # æ ‡é¢˜å­—ä½“å¤§å°
font_body = get_random_font(40)   # æ­£æ–‡å­—ä½“å¤§å°

# ç»˜åˆ¶æ ‡é¢˜
title_position = (MARGIN, MARGIN)
draw.text(title_position, title, font=font_title, fill=(random.randint(0, 100), random.randint(0, 100), random.randint(0, 100)))

# ç»˜åˆ¶æ­£æ–‡
y_offset = MARGIN + font_title.getsize(title)[1] + 30  # æ ‡é¢˜ä¸‹æ–¹ç•™å‡ºç©ºç™½
wrapped_lines = wrap_text(text, font_body, WIDTH - 2 * MARGIN)

for line in wrapped_lines:
    draw.text((MARGIN, y_offset), line, font=font_body, fill=(random.randint(0, 100), random.randint(0, 100), random.randint(0, 100)))
    y_offset += font_body.getsize(line)[1] + LINE_SPACING

# æ·»åŠ éšæœºè£…é¥°å…ƒç´ ï¼ˆå¦‚åˆ†å‰²çº¿æˆ–å›¾æ ‡ï¼‰
line_y = y_offset + 20
if random.choice([True, False]):
    # éšæœºæ·»åŠ åˆ†å‰²çº¿
    draw.line(
        [(MARGIN, line_y), (WIDTH - MARGIN, line_y)],
        fill=(random.randint(150, 255), random.randint(150, 255), random.randint(150, 255)),
        width=2
    )
else:
    # éšæœºæ·»åŠ è§’æ ‡
    corner_text = random.choice(["âœ¨ç”Ÿæ´»ç‚¹æ»´", "ğŸŒŸæ—…è¡Œè®°å¿†", "ğŸŒˆçµæ„Ÿè®°å½•"])
    corner_font = get_random_font(30)
    corner_position = (
        WIDTH - MARGIN - draw.textlength(corner_text, font=corner_font),
        HEIGHT - MARGIN - 40
    )
    draw.text(
        corner_position,
        corner_text,
        font=corner_font,
        fill=(random.randint(100, 200), random.randint(100, 200), random.randint(100, 200))
    )

# éšæœºæ·»åŠ è¾¹æ¡†ï¼ˆå¯é€‰ï¼‰
if random.choice([True, False]):
    border_color = (random.randint(200, 255), random.randint(200, 255), random.randint(200, 255))
    draw.rectangle([(0, 0), (WIDTH - 1, HEIGHT - 1)], outline=border_color, width=10)

# ä¿å­˜å¡ç‰‡
output_path = f"beautiful_card_{random.randint(1000, 9999)}.png"
image.save(output_path)
print(f"å¡ç‰‡å·²ç”Ÿæˆï¼š{output_path}")

